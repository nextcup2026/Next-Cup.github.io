
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // --- Helper Functions ---
    
    // Check if user is authenticated
    function isAuth() {
      return request.auth != null;
    }
    
    // Check if user is an Admin (based on email)
    // NOTE: For better security, you should use Custom Claims. 
    // This is a basic check for allowed emails if Custom Claims are not set up.
    function isAdmin() {
      return isAuth() && 
        (request.auth.token.email.matches('.*@admin.it') || // Example pattern
         request.auth.token.email in ['admin@torneo.it', 'gestore@torneo.it']); // REPLACE WITH YOUR ADMIN EMAILS
    }

    // --- Collections ---

    // Matches: Public Read, Admin Write
    match /artifacts/{appId}/public/data/matches/{matchId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    // Statistics (Scorers, Assists, Cards, etc.): Public Read, Admin Write
    // Wildcard match for all subcollections under 'public/data'
    match /artifacts/{appId}/public/data/{collectionName}/{docId} {
       allow read: if true;
       allow write: if isAdmin();
    }

    // Results (Legacy): Public Read, Admin Write
    match /artifacts/{appId}/public/data/results/{resultId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    // Default Deny
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
